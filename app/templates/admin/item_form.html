{% extends 'base.html' %}
{% block title %}{{ 'Edit' if item else 'Add' }} Item{% endblock %}
{% block content %}
  <h2>{{ 'Edit' if item else 'Add' }} Item</h2>
  <form method="POST" enctype="multipart/form-data">
    <div class="mb-3">
      <label for="name" class="form-label">Name</label>
      <input
        type="text"
        class="form-control"
        id="name"
        name="name"
        value="{{ item.name if item else '' }}"
        required
      />
    </div>
    <div class="mb-3">
      <label for="description" class="form-label">Description</label>
      <textarea class="form-control" id="description" name="description">{{ item.description if item else '' }}</textarea>
    </div>
    <div class="mb-3">
      <label for="price" class="form-label">Price</label>
      <input
        type="number"
        step="0.01"
        class="form-control"
        id="price"
        name="price"
        value="{{ item.price if item else '' }}"
        required
      />
    </div>
    <div class="mb-3 form-check">
      <input
        type="checkbox"
        class="form-check-input"
        id="is_sold"
        name="is_sold"
        {% if item and item.is_sold %}checked{% endif %}
      />
      <label class="form-check-label" for="is_sold">Mark as Sold</label>
    </div>
    {% if item %}
    <div class="mb-3">
      <label>Existing Images:</label>
      <div class="row">
        {% for img in item.images %}
          <div class="col-4 mb-2">
            {% if img.filename in ['demo.jpg', 'noimage.jpeg'] %}
              <img src="{{ url_for('static', filename=img.filename) }}" class="img-thumbnail" style="max-height:100px;">
            {% else %}
              <img src="{{ url_for('static', filename='uploads/' + img.filename) }}" class="img-thumbnail" style="max-height:100px;">
            {% endif %}
            <div>
              <input type="checkbox" name="delete_images" value="{{ img.id }}"> Delete<br>
              <input type="radio" name="primary_image" value="{{ img.id }}" {% if img.is_primary %}checked{% endif %}> Primary
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
    <div class="mb-3">
      <label for="images">Add Images</label>
      <input type="file" name="images" id="images" multiple accept="image/*" class="form-control">
    </div>
    <button type="submit" class="btn btn-primary">{{ 'Update' if item else 'Add' }}</button>
  </form>
  <!--{% if item and item.images %}
    {# Show the primary image #}
    {% set primary_image = (item.images|selectattr('is_primary')|first) or item.images[0] %}
    {% if primary_image.filename in ['demo.jpg', 'noimage.jpeg'] %}
      <img src="{{ url_for('static', filename=primary_image.filename) }}" class="img-thumbnail" style="max-height:100px;">
    {% else %}
      <img src="{{ url_for('static', filename='uploads/' + primary_image.filename) }}" class="img-thumbnail" style="max-height:100px;">
    {% endif %}
  {% else %}
    <img src="{{ url_for('static', filename='noimage.jpeg') }}" class="img-thumbnail" style="max-height:100px;">
  {% endif %}-->
{% endblock %}
