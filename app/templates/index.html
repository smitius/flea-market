{% extends 'base.html' %}
{% block title %}Loppis{% endblock %}
{% block content %}
  <div class="hero-section text-center mb-5">
    <h1>Hej och Välkommen</h1>
    <p>
      Vi rensar ut några saker vi inte längre behöver – och det kan vara precis vad du letar efter. Från användbara vardagssaker till saker som kan ge lite extra glädje, hoppas vi att du hittar något här som passar dig. Ta en titt och hör gärna av dig om något fångar ditt öga!
    </p>
    <p>Om du hittar något du gillar och som inte är markerat som sålt, kontakta oss via:</p>
    <ul class="list-unstyled">
      <li><strong>Chat:</strong> {{ whatsapp_number }}</li>
      <li>
        <strong>Kontakt:</strong> {{ site_name }}
      </li>
      <li><strong>Kom personligen:</strong> {{ apartment_address }}</li>
    </ul>
  </div>

  <div class="row row-cols-1 row-cols-md-3 g-4" id="itemsGrid">
    {% for item in items %}
      <div class="col">
        <div
          class="card item-card {% if item.is_sold %}sold{% endif %}"
          data-images="{% for img in item.images %}
    {% if img.filename in ['demo.jpg', 'noimage.jpeg'] %}
      {{ url_for('static', filename=img.filename) }}
    {% else %}
      {{ url_for('static', filename='uploads/' + img.filename) }}
    {% endif %}
    {% if not loop.last %},{% endif %}
  {% endfor %}"
          title="Click to view images"
          style="cursor: pointer;"
        >
          {% set primary_image = (item.images|selectattr('is_primary')|first) or (item.images[0] if item.images else None) %}
          {% if primary_image %}
            {% if primary_image.filename in ['demo.jpg', 'noimage.jpeg'] %}
              <img src="{{ url_for('static', filename=primary_image.filename) }}">
            {% else %}
              <img src="{{ url_for('static', filename='uploads/' + primary_image.filename) }}">
            {% endif %}
          {% else %}
            <img
              src="{{ url_for('static', filename='noimage.jpeg') }}"
              alt="No image available"
              class="card-img-top item-image"
            />
          {% endif %}
          <div class="card-body">
            <h5 class="card-title">{{ item.name }}</h5>
            <p class="card-text">{{ item.description }}</p>
            <p class="card-text"><strong>Pris:</strong> <span class="price-value">{{ '%.2f' | format(item.price) }} Kr</span></p>
            {% if item.is_sold %}
              <span class="badge bg-danger">Såld</span>
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

  <!-- Image Gallery Modal -->
  <div
    class="modal fade"
    id="imageGalleryModal"
    tabindex="-1"
    aria-labelledby="imageGalleryLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="imageGalleryLabel">Fler Bilder</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body text-center">
          <img
            id="galleryImage"
            src=""
            alt="Item image"
            class="img-fluid rounded"
          />
        </div>
        <div class="modal-footer justify-content-center">
          <button id="prevImage" class="btn btn-secondary">&#x25C0;</button> <!-- ◀ -->
          <button id="nextImage" class="btn btn-secondary">&#x25B6;</button> <!-- ▶ -->
        </div>
      </div>
    </div>
  </div>
{% endblock %}